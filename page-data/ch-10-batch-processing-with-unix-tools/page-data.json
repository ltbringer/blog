{"componentChunkName":"component---src-templates-post-js","path":"/ch-10-batch-processing-with-unix-tools","result":{"data":{"markdownRemark":{"html":"<p>The chapter starts with a brief on online vs offline vs stream processing systems.</p>\n<h2 id=\"systems\" style=\"position:relative;\"><a href=\"#systems\" aria-label=\"systems permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Systems</h2>\n<h3 id=\"services-online-systems\" style=\"position:relative;\"><a href=\"#services-online-systems\" aria-label=\"services online systems permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Services (online-systems)</h3>\n<ol>\n<li>Awaits a request.</li>\n<li>Sends a response.</li>\n</ol>\n<h4 id=\"metrics\" style=\"position:relative;\"><a href=\"#metrics\" aria-label=\"metrics permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Metrics</h4>\n<ul>\n<li>Response time is a measure of performance for such a system.</li>\n<li>(High) Availability is another important criteria for measuring a service.</li>\n</ul>\n<h3 id=\"batch-processing-systems-offline-systems\" style=\"position:relative;\"><a href=\"#batch-processing-systems-offline-systems\" aria-label=\"batch processing systems offline systems permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Batch Processing Systems (offline-systems)</h3>\n<ol>\n<li>Takes a large amount of data.</li>\n<li>Runs a sequence of jobs to process.</li>\n<li>Produces output.</li>\n</ol>\n<p>Often scheduled to run periodically.</p>\n<h4 id=\"metrics-1\" style=\"position:relative;\"><a href=\"#metrics-1\" aria-label=\"metrics 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Metrics</h4>\n<ul>\n<li>Throughput (time taken to produce output for a dataset of given size)</li>\n</ul>\n<h3 id=\"stream-processing-systems-near-real-time-systems\" style=\"position:relative;\"><a href=\"#stream-processing-systems-near-real-time-systems\" aria-label=\"stream processing systems near real time systems permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Stream Processing Systems (near-real-time systems)</h3>\n<ul>\n<li>Events are processed shortly after they occur.</li>\n<li>Usually stream processing systems have lower latency than batch-processing systems.</li>\n</ul>\n<h2 id=\"batch-processing-with-unix-tools\" style=\"position:relative;\"><a href=\"#batch-processing-with-unix-tools\" aria-label=\"batch processing with unix tools permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Batch Processing with Unix Tools</h2>\n<p>We get a comparison between two approaches to the same problem. The objective is to log the most requested (top) 5 urls in the order of requests made.\nThe unix approach to the problem is a consice:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">cat</span> /var/log/nginx/access.log <span class=\"token operator\">|</span> <span class=\"token function\">awk</span> <span class=\"token string\">'{print $7}'</span> <span class=\"token operator\">|</span> <span class=\"token function\">sort</span> <span class=\"token operator\">|</span> <span class=\"token function\">uniq</span> -c <span class=\"token operator\">|</span> <span class=\"token function\">sort</span> -r -n <span class=\"token operator\">|</span> <span class=\"token function\">head</span> -n <span class=\"token number\">5</span></code></pre></div>\n<p>We can get the same done via <code class=\"language-text\">python</code> like so:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">from</span> typing <span class=\"token keyword\">import</span> List\n<span class=\"token keyword\">from</span> collections <span class=\"token keyword\">import</span> defaultdict\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">read_logs</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/var/log/nginx/access.log\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"r\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> handle<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">return</span> handle<span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>splitlines<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">process_logs</span><span class=\"token punctuation\">(</span>logs<span class=\"token punctuation\">:</span> List<span class=\"token punctuation\">[</span><span class=\"token builtin\">str</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    url_requests <span class=\"token operator\">=</span> defaultdict<span class=\"token punctuation\">(</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">for</span> log <span class=\"token keyword\">in</span> logs<span class=\"token punctuation\">:</span>\n        url <span class=\"token operator\">=</span> log<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">6</span><span class=\"token punctuation\">]</span>\n        url_requests<span class=\"token punctuation\">[</span>url<span class=\"token punctuation\">]</span> <span class=\"token operator\">+=</span> <span class=\"token number\">1</span>\n    <span class=\"token keyword\">return</span> url_requests\n\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">rank</span><span class=\"token punctuation\">(</span>url_requests<span class=\"token punctuation\">,</span> n<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> reverse<span class=\"token operator\">=</span><span class=\"token boolean\">False</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>url<span class=\"token punctuation\">:</span> url_requests<span class=\"token punctuation\">[</span>url<span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span> <span class=\"token keyword\">for</span> url <span class=\"token keyword\">in</span> <span class=\"token builtin\">sorted</span><span class=\"token punctuation\">(</span>url_requests<span class=\"token punctuation\">,</span> reverse<span class=\"token operator\">=</span>reverse<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>The two might be functionally same, but we notice performance differences on larger log files.</p>\n<ul>\n<li>The in-memory <code class=\"language-text\">defaultdict</code> grows in size depending on the number of unique urls present in the log files.</li>\n<li>\n<p>The unix example can sort the urls using disk-writes.</p>\n<ul>\n<li>Data is partially sorted in-memory and moved to disks as segment files.</li>\n<li>Multiple sorted segments can be merged into a larger sorted file.</li>\n<li>Merge Sort has sequential access pattern, making it perform well on disks.</li>\n<li>Can sort data even when larger than available memory by using disks.</li>\n<li>Limited by the rate at which files can be read from disks.</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"the-unix-philosophy\" style=\"position:relative;\"><a href=\"#the-unix-philosophy\" aria-label=\"the unix philosophy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The Unix Philosophy</h2>\n<p><em>Unix pipes built in 1964 by Doug McIlroy.</em></p>\n<ol>\n<li>Make each program do one thing well. Don't complicate old programs by adding new features. Build afresh.</li>\n<li>\n<p>Expect the output of every program to become the input to another. </p>\n<ol>\n<li>Do not clutter the output with extraneous information.</li>\n<li>Avoid stringently columnar or binary input formats.</li>\n</ol>\n</li>\n<li>Design and build software to be tried early. Ideally within weeks. Don't hesitate to throw away clumsy parts and rebuild.</li>\n<li>Use tools in preference to unskilled help to lighten a programming task.</li>\n</ol>","timeToRead":2,"excerpt":"The chapter starts with a brief on online vs offline vs stream processing systems. Systems Services (online-systems) Awaits a request. Sends…","frontmatter":{"title":"Ch-10 Batch Processing With Unix Tools","cover":"https://unsplash.it/1152/300/?random?BirchintheRoses","date":"2021-12-11T00:00:00.000Z","categories":["readings"],"tags":["engineering","designing-data-intensive-applications"]},"fields":{"slug":"/ch-10-batch-processing-with-unix-tools","date":"December 10, 2021"}}},"pageContext":{"slug":"/ch-10-batch-processing-with-unix-tools","nexttitle":"Building a linked list in rust","nextslug":"/building-a-linked-list-in-rust","prevtitle":"Reanimation","prevslug":"/reanimation"}},"staticQueryHashes":["3969716136"]}